/*!
 * Galpop Image Gallery Popup
 * http://galpop.magicmediamuse.com/
 *
 * Author
 * Richard Hung
 * http://www.magicmediamuse.com/
 *
 * Version
 * 1.0.6
 *
 * Copyright (c) 2014 Richard Hung.
 *
 * License
 * Galpop Image Gallery Popup by Richard Hung is licensed under a Creative Commons Attribution-NonCommercial 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc/3.0/deed.en_US
 */

!function(t){"use strict";var o,e,a,n,i,p,l,r,c,d,s,u={arrowKeys:!0,controls:!0,loop:!0,maxWidth:null,maxHeight:null,maxScreen:90,updateRsz:!0,callback:null,lockScroll:!0},g={init:function(o){return this.click(function(e){t(this).galpop("openBox",o),e.preventDefault()})},openBox:function(e,a,n){e=t.extend({},u,e),o.data({controls:e.controls,loop:e.loop,maxWidth:e.maxWidth,maxHeight:e.maxHeight,maxScreen:e.maxScreen,callback:e.callback});var i=a,p="",l=this;return n||(n=0),"[object Array]"===Object.prototype.toString.call(a)&&(l=a,i=l[n]),a||(i=this.attr("href"),p=this.data("galpop-group"),l=t('[data-galpop-group="'+p+'"]'),n=l.index(this),e.arrowKeys&&t(document).on("keydown",c),e.updateRsz&&t(window).resize(d),e.lockScroll&&t("html").addClass("lock-scroll")),o.data({rel:p,group:l,index:n,status:!0,count:l.length}),o.fadeIn(500,"swing"),this.galpop("preload",i),this},closeBox:function(){o.removeClass("complete").fadeOut(500,"swing",function(){n.find("img").remove(),i.hide().contents().remove(),t(this).data("status",!1),p.hide(),l.hide(),t(document).off("keydown",c),t(window).off("resize",d),t("html").removeClass("lock-scroll")})},preload:function(t){return s=new Image,s.src=t,s.onload=function(){o.galpop("display")},s.onerror=function(){console.log(t+" contains a broken image!")},this},display:function(){var a=s.height,i=s.width,p=o.data("maxWidth"),l=o.data("maxHeight"),r=o.data("maxScreen"),c=t(window).height(),d=t(window).width(),u=0;(!p||p>d*r/100)&&(p=d*r/100),(!l||l>c*r/100)&&(l=c*r/100),i>p&&(u=p/i,a*=u,i*=u),a>l&&(u=l/a,i*=u,a*=u),e.css({height:a,width:i}),setTimeout(function(){o.addClass("complete"),n.append(s).find("img").height(a).width(i).fadeIn(500,"swing",function(){o.galpop("complete")})},500)},complete:function(){var e=o.data("controls"),a=o.data("callback"),n=o.data("index"),i=o.data("count"),r=o.data("loop");o.galpop("infoParse"),!e||0===n&&!r||1>=i?p.hide():p.show(),!e||n+1>=i&&!r||1>=i?l.hide():l.show(),t.isFunction(a)&&a.call(this)},moveItem:function(e){console.log("moveitem "+e);var a=o.data("group"),p=!1,l="";return o.removeClass("complete"),i.fadeOut(500,"swing",function(){t(this).contents().remove()}),n.find("img").fadeOut(500,"swing",function(){t(this).remove(),"[object Array]"===Object.prototype.toString.call(a)?l=a[e]:(p=a.eq(e),p.attr("href")?l=p.attr("href"):p.attr("src")&&(l=p.attr("href"))),t.fn.galpop("preload",l),o.data("index",e)}),this},next:function(){var t=o.data("index"),e=o.data("loop"),a=o.data("count");return a>t+1?(t++,o.galpop("moveItem",t)):e&&(t=0,o.galpop("moveItem",t)),this},prev:function(){var t=o.data("index"),e=o.data("loop"),a=o.data("count");return t>0?(t--,o.galpop("moveItem",t)):e&&(t=a-1,o.galpop("moveItem",t)),this},infoParse:function(){var e=o.data("group");if(e instanceof jQuery){var a=o.data("index"),n=e.eq(a),p=t.trim(n.attr("title")),l=t.trim(n.data("galpop-link")),r=t.trim(n.data("galpop-link-title")),c=t.trim(n.data("galpop-link-target"));i.html(""),p&&t("<p>"+p+"</p>").appendTo(i),l&&(r||(r=l),c&&(c='target="'+c+'"'),t('<p><a href="'+l+'" '+c+">"+r+"</a></p>").appendTo(i)),(p||l)&&i.fadeIn(500,"swing")}},update:function(){var t=o.data("index");return o.galpop("moveItem",t),this},destroy:function(){return this.off("click")}};t.fn.galpop=function(o){return g[o]?g[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void t.error("Method "+o+" does not exist on jQuery.galpop"):g.init.apply(this,arguments)},t(document).ready(function(){o=t('<div id="galpop-wrapper" />').appendTo("body"),e=t('<div id="galpop-container" />').appendTo(o),p=t('<a href="#" id="galpop-prev" />').appendTo(e),l=t('<a href="#" id="galpop-next" />').appendTo(e),a=t('<div id="galpop-ajax" />').appendTo(e),n=t('<div id="galpop-content" />').appendTo(e),i=t('<div id="galpop-info" />').appendTo(n),r=t('<a href="#" id="galpop-close" />').appendTo(n),o.click(function(o){t(this).galpop("closeBox"),o.preventDefault()}),e.click(function(t){t.stopPropagation()}),p.hide().click(function(t){o.galpop("prev"),t.preventDefault()}),l.hide().click(function(t){o.galpop("next"),t.preventDefault()}),r.click(function(t){o.galpop("closeBox"),t.preventDefault()}),i.on("click","a",function(){o.galpop("closeBox")}),c=function(t){var e=t.which,a=!1;switch(e){case 27:o.galpop("closeBox"),a=!0;break;case 37:o.galpop("prev"),a=!0;break;case 39:o.galpop("next"),a=!0}a&&t.preventDefault()},d=function(){o.galpop("update")}})}(jQuery);
