/*!
 * Galpop Image Gallery Popup
 * http://galpop.magicmediamuse.com/
 *
 * Author
 * Richard Hung
 * http://www.magicmediamuse.com/
 *
 * Version
 * 1.0.4
 * 
 * Copyright (c) 2014 Richard Hung.
 * 
 * License
 * Galpop Image Gallery Popup by Richard Hung is licensed under a Creative Commons Attribution-NonCommercial 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc/3.0/deed.en_US
 */


(function(a){"use strict";var e={init:function(e){var o={arrowKeys:true,controls:true,loop:true,maxWidth:null,maxHeight:null,maxScreen:90,updateRsz:true,callback:null,lockScroll:true};e=a.extend({},o,e);return this.click(function(o){t.data({arrowKeys:e.arrowKeys,controls:e.controls,loop:e.loop,maxWidth:e.maxWidth,maxHeight:e.maxHeight,maxScreen:e.maxScreen,updateRsz:e.updateRsz,callback:e.callback,lockScroll:e.lockScroll});a(this).galpop("openBox");o.preventDefault()})},openBox:function(){var e=this.data("galpop-group");var o=a('[data-galpop-group="'+e+'"]');var n=o.index(this);var i=t.data("arrowKeys");var r=t.data("updateRsz");var p=t.data("lockScroll");if(i){a(document).on("keydown",c)}if(r){a(window).resize(s)}if(p){a("html").addClass("lock-scroll")}t.fadeIn(500,"swing");t.data({rel:e,group:o,index:n,status:true,count:o.length});this.galpop("preload");return this},closeBox:function(){t.removeClass("complete").fadeOut(500,"swing",function(){i.find("img").remove();r.hide().contents().remove();a(this).data("status",false);p.hide();l.hide();a(document).off("keydown",c);a(window).off("resize",s);a("html").removeClass("lock-scroll")})},preload:function(){var a=this.attr("href");u=new Image;u.src=a;u.onload=function(){t.galpop("display")};u.onerror=function(){console.log(a+" contains a broken image!")};return this},display:function(){var e=u.height;var n=u.width;var r=t.data("maxWidth");var p=t.data("maxHeight");var l=t.data("maxScreen");var d=a(window).height();var c=a(window).width();var s=0;if(!r||r>c*l/100){r=c*l/100}if(!p||p>d*l/100){p=d*l/100}if(n>r){s=r/n;e=e*s;n=n*s}if(e>p){s=p/e;n=n*s;e=e*s}o.css({height:e,width:n});setTimeout(function(){t.addClass("complete");i.append(u).find("img").height(e).width(n).fadeIn(500,"swing",function(){t.galpop("complete")})},500)},complete:function(){var e=t.data("controls");var o=t.data("callback");var n=t.data("index");var i=t.data("count");var r=t.data("loop");t.galpop("infoParse");if(!e||n===0&&!r||i<=1){p.hide()}else{p.show()}if(!e||n+1>=i&&!r||i<=1){l.hide()}else{l.show()}if(a.isFunction(o)){o.call(this)}},moveItem:function(e){var o=t.data("group");t.removeClass("complete");r.fadeOut(500,"swing",function(){a(this).contents().remove()});i.find("img").fadeOut(500,"swing",function(){a(this).remove();o.eq(e).galpop("preload");t.data("index",e)});return this},next:function(){var a=t.data("index");var e=t.data("loop");var o=t.data("count");if(a+1<o){a++;t.galpop("moveItem",a)}else if(e){a=0;t.galpop("moveItem",a)}return this},prev:function(){var a=t.data("index");var e=t.data("loop");var o=t.data("count");if(a>0){a--;t.galpop("moveItem",a)}else if(e){a=o-1;t.galpop("moveItem",a)}return this},infoParse:function(){var e=t.data("index");var o=t.data("group");var n=o.eq(e);var i=a.trim(n.attr("title"));var p=a.trim(n.data("galpop-link"));var l=a.trim(n.data("galpop-link-title"));var d=a.trim(n.data("galpop-link-target"));r.html("");if(i!==""){a("<p>"+i+"</p>").appendTo(r)}if(p!==""){if(l===""){l=p}if(d!==""){d='target="'+d+'"'}a('<p><a href="'+p+'" '+d+">"+l+"</a></p>").appendTo(r)}if(i!==""||p!==""){r.fadeIn(500,"swing")}},update:function(){var a=t.data("index");t.galpop("moveItem",a);return this},destroy:function(){return this.off("click")}};a.fn.galpop=function(t){if(e[t]){return e[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return e.init.apply(this,arguments)}else{a.error("Method "+t+" does not exist on jQuery.galpop")}};var t,o,n,i,r,p,l,d,c,s,u;a(document).ready(function(){t=a('<div id="galpop-wrapper" />').prependTo("body");o=a('<div id="galpop-container" />').appendTo(t);p=a('<a href="#" id="galpop-prev" />').appendTo(o);l=a('<a href="#" id="galpop-next" />').appendTo(o);n=a('<div id="galpop-ajax" />').appendTo(o);i=a('<div id="galpop-content" />').appendTo(o);r=a('<div id="galpop-info" />').appendTo(i);d=a('<a href="#" id="galpop-close" />').appendTo(i);t.click(function(e){a(this).galpop("closeBox");e.preventDefault()});o.click(function(a){a.stopPropagation()});p.hide().click(function(a){t.galpop("prev");a.preventDefault()});l.hide().click(function(a){t.galpop("next");a.preventDefault()});d.click(function(a){t.galpop("closeBox");a.preventDefault()});r.on("click","a",function(){t.galpop("closeBox")});c=function(a){var e=a.which;var o=false;switch(e){case 27:t.galpop("closeBox");o=true;break;case 37:t.galpop("prev");o=true;break;case 39:t.galpop("next");o=true;break}if(o){a.preventDefault()}};s=function(){t.galpop("update")}})})(jQuery);